{"ast":null,"code":"import { create } from 'zustand';\nimport { subscribeWithSelector } from 'zustand/middleware';\nconst initialGameState = {\n  player_hands: {\n    0: {\n      tiles: [],\n      melds: []\n    },\n    1: {\n      tiles: [],\n      melds: []\n    },\n    2: {\n      tiles: [],\n      melds: []\n    },\n    3: {\n      tiles: [],\n      melds: []\n    }\n  },\n  discarded_tiles: [],\n  player_discarded_tiles: {\n    0: [],\n    1: [],\n    2: [],\n    3: []\n  },\n  remaining_tiles: [],\n  current_player: 0,\n  actions_history: []\n};\nexport const useGameStore = create()(subscribeWithSelector((set, get) => ({\n  // 初始状态\n  gameState: initialGameState,\n  analysisResult: null,\n  isAnalyzing: false,\n  availableTiles: [],\n  isConnected: false,\n  connectionId: null,\n  // Setters\n  setGameState: gameState => set({\n    gameState\n  }),\n  setAnalysisResult: result => set({\n    analysisResult: result\n  }),\n  setIsAnalyzing: analyzing => set({\n    isAnalyzing: analyzing\n  }),\n  setAvailableTiles: tiles => set({\n    availableTiles: tiles\n  }),\n  setConnectionStatus: (connected, id) => set({\n    isConnected: connected,\n    connectionId: id || null\n  }),\n  // 游戏操作\n  addTileToHand: (playerId, tile) => set(state => {\n    const newGameState = {\n      ...state.gameState\n    };\n    const playerHand = {\n      ...newGameState.player_hands[playerId]\n    };\n    playerHand.tiles = [...playerHand.tiles, tile];\n    newGameState.player_hands[playerId] = playerHand;\n    return {\n      gameState: newGameState\n    };\n  }),\n  removeTileFromHand: (playerId, tileToRemove) => set(state => {\n    const newGameState = {\n      ...state.gameState\n    };\n    const playerHand = {\n      ...newGameState.player_hands[playerId]\n    };\n\n    // 找到第一个匹配的牌并移除\n    const tileIndex = playerHand.tiles.findIndex(tile => tile.type === tileToRemove.type && tile.value === tileToRemove.value);\n    if (tileIndex !== -1) {\n      playerHand.tiles = [...playerHand.tiles.slice(0, tileIndex), ...playerHand.tiles.slice(tileIndex + 1)];\n      newGameState.player_hands[playerId] = playerHand;\n    }\n    return {\n      gameState: newGameState\n    };\n  }),\n  addDiscardedTile: (tile, playerId = 0) => set(state => {\n    const newGameState = {\n      ...state.gameState\n    };\n\n    // 添加到全局弃牌池（保持兼容性）\n    newGameState.discarded_tiles = [...newGameState.discarded_tiles, tile];\n\n    // 添加到指定玩家的弃牌池\n    if (newGameState.player_discarded_tiles) {\n      newGameState.player_discarded_tiles = {\n        ...newGameState.player_discarded_tiles,\n        [playerId]: [...(newGameState.player_discarded_tiles[playerId] || []), tile]\n      };\n    } else {\n      newGameState.player_discarded_tiles = {\n        0: playerId === 0 ? [tile] : [],\n        1: playerId === 1 ? [tile] : [],\n        2: playerId === 2 ? [tile] : [],\n        3: playerId === 3 ? [tile] : []\n      };\n    }\n    return {\n      gameState: newGameState\n    };\n  }),\n  addMeld: (playerId, meld) => set(state => {\n    const newGameState = {\n      ...state.gameState\n    };\n    const playerHand = {\n      ...newGameState.player_hands[playerId]\n    };\n    playerHand.melds = [...playerHand.melds, meld];\n    newGameState.player_hands[playerId] = playerHand;\n    return {\n      gameState: newGameState\n    };\n  }),\n  addAction: action => set(state => {\n    const newGameState = {\n      ...state.gameState\n    };\n    newGameState.actions_history = [...newGameState.actions_history, action];\n    return {\n      gameState: newGameState\n    };\n  }),\n  // 重置功能\n  resetGame: () => set({\n    gameState: initialGameState,\n    analysisResult: null,\n    isAnalyzing: false\n  }),\n  clearAnalysis: () => set({\n    analysisResult: null\n  })\n})));\n\n// 选择器函数，用于获取特定数据\nexport const selectPlayerHand = playerId => state => state.gameState.player_hands[playerId];\nexport const selectMyHand = () => state => state.gameState.player_hands[0]; // 假设玩家ID为0\n\nexport const selectDiscardedTiles = () => state => state.gameState.discarded_tiles;\nexport const selectPlayerDiscardedTiles = playerId => state => {\n  var _state$gameState$play;\n  return ((_state$gameState$play = state.gameState.player_discarded_tiles) === null || _state$gameState$play === void 0 ? void 0 : _state$gameState$play[playerId]) || [];\n};\nexport const selectAnalysis = () => state => state.analysisResult;\nexport const selectIsAnalyzing = () => state => state.isAnalyzing;","map":{"version":3,"names":["create","subscribeWithSelector","initialGameState","player_hands","tiles","melds","discarded_tiles","player_discarded_tiles","remaining_tiles","current_player","actions_history","useGameStore","set","get","gameState","analysisResult","isAnalyzing","availableTiles","isConnected","connectionId","setGameState","setAnalysisResult","result","setIsAnalyzing","analyzing","setAvailableTiles","setConnectionStatus","connected","id","addTileToHand","playerId","tile","state","newGameState","playerHand","removeTileFromHand","tileToRemove","tileIndex","findIndex","type","value","slice","addDiscardedTile","addMeld","meld","addAction","action","resetGame","clearAnalysis","selectPlayerHand","selectMyHand","selectDiscardedTiles","selectPlayerDiscardedTiles","_state$gameState$play","selectAnalysis","selectIsAnalyzing"],"sources":["D:/codes/PocketFlow-Tutorial-Codebase-Knowledge/paul/mj/frontend/src/stores/gameStore.ts"],"sourcesContent":["import { create } from 'zustand';\nimport { subscribeWithSelector } from 'zustand/middleware';\nimport { \n  GameState, \n  AnalysisResult, \n  Tile, \n  HandTiles, \n  PlayerAction,\n  TileInfo,\n  MeldType,\n  Meld,\n  TileType,\n  GangType\n} from '../types/mahjong';\n\ninterface GameStore {\n  // 游戏状态\n  gameState: GameState;\n  analysisResult: AnalysisResult | null;\n  isAnalyzing: boolean;\n  \n  // 可用牌信息\n  availableTiles: TileInfo[];\n  \n  // WebSocket连接状态\n  isConnected: boolean;\n  connectionId: string | null;\n  \n  // Actions\n  setGameState: (gameState: GameState) => void;\n  setAnalysisResult: (result: AnalysisResult) => void;\n  setIsAnalyzing: (analyzing: boolean) => void;\n  setAvailableTiles: (tiles: TileInfo[]) => void;\n  setConnectionStatus: (connected: boolean, id?: string) => void;\n  \n  // 游戏操作\n  addTileToHand: (playerId: number, tile: Tile) => void;\n  removeTileFromHand: (playerId: number, tile: Tile) => void;\n  addDiscardedTile: (tile: Tile, playerId?: number) => void;\n  addMeld: (playerId: number, meld: Meld) => void;\n  addAction: (action: PlayerAction) => void;\n  \n  // 重置功能\n  resetGame: () => void;\n  clearAnalysis: () => void;\n}\n\nconst initialGameState: GameState = {\n  player_hands: {\n    0: { tiles: [], melds: [] },\n    1: { tiles: [], melds: [] },\n    2: { tiles: [], melds: [] },\n    3: { tiles: [], melds: [] }\n  },\n  discarded_tiles: [],\n  player_discarded_tiles: {\n    0: [],\n    1: [],\n    2: [],\n    3: []\n  },\n  remaining_tiles: [],\n  current_player: 0,\n  actions_history: []\n};\n\nexport const useGameStore = create<GameStore>()(\n  subscribeWithSelector((set, get) => ({\n    // 初始状态\n    gameState: initialGameState,\n    analysisResult: null,\n    isAnalyzing: false,\n    availableTiles: [],\n    isConnected: false,\n    connectionId: null,\n    \n    // Setters\n    setGameState: (gameState) => set({ gameState }),\n    \n    setAnalysisResult: (result) => set({ analysisResult: result }),\n    \n    setIsAnalyzing: (analyzing) => set({ isAnalyzing: analyzing }),\n    \n    setAvailableTiles: (tiles) => set({ availableTiles: tiles }),\n    \n    setConnectionStatus: (connected, id) => \n      set({ isConnected: connected, connectionId: id || null }),\n    \n    // 游戏操作\n    addTileToHand: (playerId, tile) => set((state) => {\n      const newGameState = { ...state.gameState };\n      const playerHand = { ...newGameState.player_hands[playerId] };\n      playerHand.tiles = [...playerHand.tiles, tile];\n      newGameState.player_hands[playerId] = playerHand;\n      \n      return { gameState: newGameState };\n    }),\n    \n    removeTileFromHand: (playerId, tileToRemove) => set((state) => {\n      const newGameState = { ...state.gameState };\n      const playerHand = { ...newGameState.player_hands[playerId] };\n      \n      // 找到第一个匹配的牌并移除\n      const tileIndex = playerHand.tiles.findIndex(tile => \n        tile.type === tileToRemove.type && tile.value === tileToRemove.value\n      );\n      \n      if (tileIndex !== -1) {\n        playerHand.tiles = [\n          ...playerHand.tiles.slice(0, tileIndex),\n          ...playerHand.tiles.slice(tileIndex + 1)\n        ];\n        newGameState.player_hands[playerId] = playerHand;\n      }\n      \n      return { gameState: newGameState };\n    }),\n    \n    addDiscardedTile: (tile, playerId = 0) => set((state) => {\n      const newGameState = { ...state.gameState };\n      \n      // 添加到全局弃牌池（保持兼容性）\n      newGameState.discarded_tiles = [...newGameState.discarded_tiles, tile];\n      \n      // 添加到指定玩家的弃牌池\n      if (newGameState.player_discarded_tiles) {\n        newGameState.player_discarded_tiles = {\n          ...newGameState.player_discarded_tiles,\n          [playerId]: [...(newGameState.player_discarded_tiles[playerId] || []), tile]\n        };\n      } else {\n        newGameState.player_discarded_tiles = {\n          0: playerId === 0 ? [tile] : [],\n          1: playerId === 1 ? [tile] : [],\n          2: playerId === 2 ? [tile] : [],\n          3: playerId === 3 ? [tile] : []\n        };\n      }\n      \n      return { gameState: newGameState };\n    }),\n    \n    addMeld: (playerId, meld) => set((state) => {\n      const newGameState = { ...state.gameState };\n      const playerHand = { ...newGameState.player_hands[playerId] };\n      playerHand.melds = [...playerHand.melds, meld];\n      newGameState.player_hands[playerId] = playerHand;\n      \n      return { gameState: newGameState };\n    }),\n    \n    addAction: (action) => set((state) => {\n      const newGameState = { ...state.gameState };\n      newGameState.actions_history = [...newGameState.actions_history, action];\n      return { gameState: newGameState };\n    }),\n    \n    // 重置功能\n    resetGame: () => set({\n      gameState: initialGameState,\n      analysisResult: null,\n      isAnalyzing: false\n    }),\n    \n    clearAnalysis: () => set({ analysisResult: null })\n  }))\n);\n\n// 选择器函数，用于获取特定数据\nexport const selectPlayerHand = (playerId: number) => (state: GameStore) => \n  state.gameState.player_hands[playerId];\n\nexport const selectMyHand = () => (state: GameStore) => \n  state.gameState.player_hands[0]; // 假设玩家ID为0\n\nexport const selectDiscardedTiles = () => (state: GameStore) => \n  state.gameState.discarded_tiles;\n\nexport const selectPlayerDiscardedTiles = (playerId: number) => (state: GameStore) => \n  state.gameState.player_discarded_tiles?.[playerId] || [];\n\nexport const selectAnalysis = () => (state: GameStore) => \n  state.analysisResult;\n\nexport const selectIsAnalyzing = () => (state: GameStore) => \n  state.isAnalyzing; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}